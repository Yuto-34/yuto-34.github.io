<!DOCTYPE html>
<html lang="ja">
<head>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-162881724-3"></script>
<script>
	window.dataLayer = window.dataLayer || [];

	function gtag() {
		dataLayer.push(arguments);
	}
	gtag('js', new Date());

	gtag('config', 'UA-162881724-3');

</script>

<!-- jQueryの指定 -->
<script type="text/javascript" src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
<!-- ＃リンクのスムーズスクロール -->
<script>
	$(function() {
		// #で始まるリンクをクリックしたら実行されます
		$('a[href^="#"]').click(function() {
			// スクロールの速度
			var speed = 400; // ミリ秒で記述
			var href = $(this).attr("href");
			var target = $(href == "#" || href == "" ? 'html' : href);
			var position = target.offset().top;
			$('body,html').animate({
				scrollTop: position
			}, speed, 'swing');
			return false;
		});
	});

</script>
<script src="https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js?lang=latex&lang=tex&lang=ruby&lang=c&lang=html&lang=css&lang=js&lang=bash&lang=sh"></script>
<script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script type="text/x-mathjax-config"> MathJax.Hub.Config({
    TeX: { equationNumbers: { autoNumber: "AMS" }},
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"] ],
        processEscapes: true
    },
    "HTML-CSS": { matchFontHeight: false },
    displayAlign: "left",
    displayIndent: "2em"
});
</script>

<!-- Place your kit's code here -->
<script src="https://kit.fontawesome.com/da2a99b904.js" crossorigin="anonymous"></script>

<meta charset="utf-8" />
<meta name="msapplication-square70x70logo" content="./favicons/site-tile-70x70.png">
<meta name="msapplication-square150x150logo" content="./favicons/site-tile-150x150.png">
<meta name="msapplication-wide310x150logo" content="./favicons/site-tile-310x150.png">
<meta name="msapplication-square310x310logo" content="./favicons/site-tile-310x310.png">
<meta name="msapplication-TileColor" content="#0078d7">
<link rel="shortcut icon" type="image/vnd.microsoft.icon" href="./favicons/favicon.ico">
<link rel="icon" type="image/vnd.microsoft.icon" href="./favicons/favicon.ico">
<link rel="apple-touch-icon" sizes="57x57" href="./favicons/apple-touch-icon-57x57.png">
<link rel="apple-touch-icon" sizes="60x60" href="./favicons/apple-touch-icon-60x60.png">
<link rel="apple-touch-icon" sizes="72x72" href="./favicons/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="76x76" href="./favicons/apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" sizes="114x114" href="./favicons/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="120x120" href="./favicons/apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" sizes="144x144" href="./favicons/apple-touch-icon-144x144.png">
<link rel="apple-touch-icon" sizes="152x152" href="./favicons/apple-touch-icon-152x152.png">
<link rel="apple-touch-icon" sizes="180x180" href="./favicons/apple-touch-icon-180x180.png">
<link rel="icon" type="image/png" sizes="36x36" href="./favicons/android-chrome-36x36.png">
<link rel="icon" type="image/png" sizes="48x48" href="./favicons/android-chrome-48x48.png">
<link rel="icon" type="image/png" sizes="72x72" href="./favicons/android-chrome-72x72.png">
<link rel="icon" type="image/png" sizes="96x96" href="./favicons/android-chrome-96x96.png">
<link rel="icon" type="image/png" sizes="128x128" href="./favicons/android-chrome-128x128.png">
<link rel="icon" type="image/png" sizes="144x144" href="./favicons/android-chrome-144x144.png">
<link rel="icon" type="image/png" sizes="152x152" href="./favicons/android-chrome-152x152.png">
<link rel="icon" type="image/png" sizes="192x192" href="./favicons/android-chrome-192x192.png">
<link rel="icon" type="image/png" sizes="256x256" href="./favicons/android-chrome-256x256.png">
<link rel="icon" type="image/png" sizes="384x384" href="./favicons/android-chrome-384x384.png">
<link rel="icon" type="image/png" sizes="512x512" href="./favicons/android-chrome-512x512.png">
<link rel="icon" type="image/png" sizes="36x36" href="./favicons/icon-36x36.png">
<link rel="icon" type="image/png" sizes="48x48" href="./favicons/icon-48x48.png">
<link rel="icon" type="image/png" sizes="72x72" href="./favicons/icon-72x72.png">
<link rel="icon" type="image/png" sizes="96x96" href="./favicons/icon-96x96.png">
<link rel="icon" type="image/png" sizes="128x128" href="./favicons/icon-128x128.png">
<link rel="icon" type="image/png" sizes="144x144" href="./favicons/icon-144x144.png">
<link rel="icon" type="image/png" sizes="152x152" href="./favicons/icon-152x152.png">
<link rel="icon" type="image/png" sizes="160x160" href="./favicons/icon-160x160.png">
<link rel="icon" type="image/png" sizes="192x192" href="./favicons/icon-192x192.png">
<link rel="icon" type="image/png" sizes="196x196" href="./favicons/icon-196x196.png">
<link rel="icon" type="image/png" sizes="256x256" href="./favicons/icon-256x256.png">
<link rel="icon" type="image/png" sizes="384x384" href="./favicons/icon-384x384.png">
<link rel="icon" type="image/png" sizes="512x512" href="./favicons/icon-512x512.png">
<link rel="icon" type="image/png" sizes="16x16" href="./favicons/icon-16x16.png">
<link rel="icon" type="image/png" sizes="24x24" href="./favicons/icon-24x24.png">
<link rel="icon" type="image/png" sizes="32x32" href="./favicons/icon-32x32.png">
<link rel="manifest" href="./favicons/manifest.json">
<!-- ###################################################
				ここからはページ毎に変更する
	################################################### -->
<link rel="stylesheet" type="text/css" href="./import_1.css" />
<meta name="description" content="UEC19 Yutoの課題メモ" />
<title>Code Memo</title>
<link href="https://use.fontawesome.com/releases/v5.6.1/css/all.css" rel="stylesheet">
<style>

	.check {
        position: relative;
        left: -13px;
		list-style-type: none !important;
		/*ポチ消す*/
    }

	.check:before {
        font-weight: 900;
		font-family: "Font Awesome 5 Free";
        content: "\f00c";
        position: relative;
        left: -7px;
		/*左端からのアイコンまで*/
		color: #ffb03f;
		/*アイコン色*/
	}

</style>
</head>

<body>

<div id="outer">

	<h1 class="bar">課題No.3</h1>

	<div id="main">

		<div class="content">

			<h2> 課題 </h2>
			<p>
				次の定積分を数値積分によって求め、正確な積分値と比較考察せよ。
			</p>
			\[
			\int_{-1}^{1} xe^x \mathrm{d}x
			\]
			<p>
				この時、以下の条件をすべて満たした、<b>ひとつのプログラム</b>を作成すること。
			</p>
			<ol>
				<li> 最初に、 被積分関数を代数(数式)的に積分して原始関数を (手計算で) 求め、 これを C 言語の関数として定義した上で、 積分範囲の上限と下限を与えることにより 厳密な積分値を計算して出力する。 </li>
				<li> 次に、 課題に与えられた被積分関数を C の関数として定義し、 これを用いて Simpson の 3/8 公式 (三次のニュートン・コーツ公式) にしたがって 数値積分を行ない 結果を求める。 ここで分割数 (分点の数-1:公式を適用する回数ではないことに注意) は実行時に入力することとし、 入力された分割数の満たすべき条件などをチェックして 満足なものが与えられるまで入力を要求し続けること。 また、 分割数として零または負の値が与えられるまで、 分割数の入力と数値積分結果の出力を何回でも繰り返すこと。 </li>
			</ol>
			<p> 以上について、 得られた積分結果と その計算方法や分割数・精度などについて 考察を行なうこと。 また、 各自で任意の被積分関数ひとつについて、 同様の考察を行なえ。

				<br> さらに、 余裕のある者は、 他の公式を用いた結果とも比較してみよ。 ただし、精度の比較を行なう際には、 関数値を計算する分点数の総数をおおよそ等しくして考察すること。 </p>
			<p> まとめると，ポイントは以下 </p>
			<ul>
				<li class="check">ひとつのプログラムとして，Simpsonの3/8公式による数値積分を実行するプログラムを完成する． </li>
                <li class="check">被積分関数の原始関数を求めて，C言語の関数として定義</li>
                <li class="check"> 厳密解を求め，出力する機能を実装 </li>
				<li class="check">入力された分割数が適当な値でない場合は，再度，入力を要求する機能を有する．</li>
				<li class="check">分割数として零または負の値が与えられるまで、 分割数の入力と数値積分結果の出力を何回でも繰り返す．</li>
				<li class="check"><a href="#explain">計算方法の原理に関する説明．</a></li>
				<li class="check">各自で被積分関数を用意して，結果を示す．</li>
				<li class="check"><a href="#thought">分割数が精度に及ぼす影響を考察する．</a>必要に応じてグラフを添付してもよいこととする．</li>
				<li>その他．
            </ul>
			<p> 余裕があれば， </p>
			<ul>
				<li>他の公式との比較．(その際には分点数の総数を等しくして考察)</li>
            </ul>

			<h2> 対応資料 </h2>
			<p>
				<a class="exit" rel="noopenner" target="blanc" href="https://drive.google.com/drive/folders/1AUsVRRk54RYw0GY2iKGJbU-hZ8txxda6?usp=sharing">Google Drive</a>
			</p>

			<h2> Code </h2>
			<h3> Ass.c </h3>
			<figure>
				<code contenteditable="true">
					<pre class="prettyprint linenums lang-c" contenteditable="true">
#include &lt;math.h&gt;
#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;unistd.h&gt;

/* 1910098 Yuto Uematsu */
/* 課題(simpton) */

double fun(double x) {
    // 被積分関数
    return x * exp(x);
}

double func(double x) {
    // 原始関数
    return (x - 1) * exp(x);
}

double exact(int xfrom, int xto) {
    // 厳密解
    return func(xto) - func(xfrom);
}

int main(int argc, char **argv) {
    double x, sum, hh;
    double xfrom = -1;
    double xto = 1;
    int xsteps, xidx;
    double solidans = 0;

    // 数値の入力 from here
    // 入力を終了したいときは0以下の数を入力
    while (1) {
        printf("x: steps> ");
        scanf("%d", &xsteps);
        if (xsteps <= 0) {
            return 0;
        }
        if (xsteps % 3) {
            printf("Bad steps\n");
            continue;
        }
        // 数値の入力 to here
        // 計算 form here
        solidans = exact(xfrom, xto);
        sum = 0;
        hh = (xto - xfrom) / xsteps;
        for (xidx = 0; xidx < xsteps; xidx += 3) {
            // 内分点の計算
            x = (xfrom * (xsteps - xidx) + xto * xidx) / xsteps;
            sum += 2 * fun(x) + 3 * (fun(x + hh) + fun(x + 2 * hh));
        }
        sum += -fun(xfrom) + fun(xto);
        sum *= 3.0 * hh / 8.0;
        printf(" ans :%20.15lf\nexact:%20.15lf\n", sum, solidans);
        printf("error:%20.15lf\n", (solidans - sum) / solidans);
        // 計算 to here
    }
    return 0;
}
</pre>
				</code>
			</figure>


		</div>
		<div>
			<h2 id="explain">計算方法の原理に関する説明</h2>
			<textarea style="width: 100%;" rows="25">
solidans = exact(xfrom, xto);
まずここで厳密解を求め，solidansに代入します．
sum = 0;
積分結果を代入するdouble型を用意します．
hh = (xto - xfrom) / xsteps;
区分求積法の一つの微小区間幅を求め，hhと定義します．
for (xidx = 0; xidx < xsteps; xidx += 3) {
(int)xidx を用意し，xstepを超えないように3ずつ増加させます．
これは一回での積分領域を指定してます．
	x = (xfrom * (xsteps - xidx) + xto * xidx) / xsteps;
	ここで内分点を求め，xとします．
	この内分点は，積分区間の左端です．
	sum += 2 * fun(x) + 3 * (fun(x + hh) + fun(x + 2 * hh));
	sum にxでの値の2倍，(x + hh)での値の3倍，(x + 2hh)での値の3倍を加える．
	ここで係数が[2 3 3]であるのは，シンプソン公式での重みが[1 3 3 1]であり，端で重なり合うことを考えると
	[1 3 3 2 3 3 2 ... 1]となるので，理にかなっている．
}
sum += -fun(xfrom) + fun(xto);
左右の重みのずれを補正する．
sum *= 3.0 * hh / 8.0;
全体に3 * hh / 8の重みをかける．
これで3/8公式にあてはめることができた．
したがって計算は理にかなっているといえる．
printf(" ans :%20.15lf\nexact:%20.15lf\n", sum, solidans);
</textarea>
		</div>
			<h2> 実行結果 </h2>
			<figure>
				<code contenteditable="true">
<pre class="prettyprint lang-bash" lang-sh contenteditable="true">
$ gcc -Wall -g -o Ass Ass.c -lm
$ ./Ass
x: steps> 3
 ans :0.757370875449975611282127374579
exact:0.735758882342884668048554885900
error:-0.029373744069893722996589247032
x: steps> 30
 ans :0.735761381524993485214736210764
exact:0.735758882342884668048554885900
error:-0.000003396740656203829278781021
x: steps> 300
 ans :0.735758882593186225307135828189
exact:0.735758882342884668048554885900
error:-0.000000000340195087365500907309
x: steps> 3000
 ans :0.735758882342909981133516339469
exact:0.735758882342884668048554885900
error:-0.000000000000034404049436479585
x: steps> 30000 
 ans :0.735758882342885001115462273447
exact:0.735758882342884668048554885900
error:-0.000000000000000452684861006310
x: steps> 300000
 ans :0.735758882342886888494604136213
exact:0.735758882342884668048554885900
error:-0.000000000000003017899073375402
x: steps> 3000000
 ans :0.735758882342888109739931223885
exact:0.735758882342884668048554885900
error:-0.000000000000004677743563731873
x: steps> 30000000
3 ans :0.735758882342880560223363772820
exact:0.735758882342884668048554885900
error:0.000000000000005583113285744494
x: steps> 300000000
 ans :0.735758882342961273437254021701
exact:0.735758882342884668048554885900
error:-0.000000000000104117518031451374
x: steps> 0
$ 
</pre>
</code>
			</figure>
			<h2>被積分関数：$\sin^2 x\cos x $</h2>
			<figure>
				<code contenteditable="true">
<pre class="prettyprint lang-bash" lang-sh contenteditable="true">
$ gcc -g -o Ass2 Ass2.c -lm
$ ./Ass2
x: steps> 3
 ans :0.343032340476047359345557197230
exact:0.397215491060637082565420996616
error:0.136407445842333413521529905665
x: steps> 6
 ans :0.396897563486290683165691461909
exact:0.397215491060637082565420996616
error:0.000800390673328160912915196779
x: steps> 9
 ans :0.397163558145451622838351113387
exact:0.397215491060637082565420996616
error:0.000130742421567672171796650749
x: steps> 90
 ans :0.397215486529763128764614066313
exact:0.397215491060637082565420996616
error:0.000000011406589258899634318746
x: steps> 900
 ans :0.397215491060184666682886245326
exact:0.397215491060637082565420996616
error:0.000000000001138968375394220440
x: steps> 9000
 ans :0.397215491060636693987362377811
exact:0.397215491060637082565420996616
error:0.000000000000000978255046350864
x: steps> 90000
 ans :0.397215491060637471143479615421
exact:0.397215491060637082565420996616
error:-0.000000000000000978255046350864
x: steps> 900000
 ans :0.397215491060645020660047066485
exact:0.397215491060637082565420996616
error:-0.000000000000019984353089739080
x: steps> 9000000
9 ans :0.397215491060638414833050546804
exact:0.397215491060637082565420996616
error:-0.000000000000003354017301774391
x: steps> 90000000
 ans :0.397215491060631642472600333349
exact:0.397215491060637082565420996616
error:0.000000000000013695570648912098
x: steps> 0
$ 
</pre>
</code>
			</figure>
			<div>
				<h2 id="thought">分割数が精度に及ぼす影響</h2>
				<textarea style="width: 100%;" rows="25">
分割数が精度に及ぼす影響について考察する．
上記結果の通り，分割数を10倍すると，相対誤差はおおよそ10^4スケールで減少していく．
しかし，ある一定の値を超えると，今度は逆に多少誤差が大きくなる．
その原因は，関数の波の数が増えることで，元来曲線に近かったものが，波の数(分点)が増えたせいでかえって波が曲線に添わなくなるからであると推測される．
その具体的な例として，f(x) = 1/(1 + 25x^2)がある．
これは分割数4の時は比較的きれいに曲線に沿い，誤差が小さくなる．
一方分割点を8にすると今度は曲線から離れてしまう．
このような現象は，どんな関数であっても起こりうると考えられ，その結果分割数を多くしても精度が一定以上上がらないという現象が起こることが分かる．
</textarea>
			</div>

			<!-- <h2>C</h2>
			<figure>
				<code contenteditable="true">
<pre class="prettyprint linenums lang-c++ " contenteditable="true">

</pre>
</code>
			</figure> -->

		<div id="footer">

			<div class="copy">&#169; 2020 Yutoのホームページ</div>
		</div>
	</div>
</div>
</body>

</html>
